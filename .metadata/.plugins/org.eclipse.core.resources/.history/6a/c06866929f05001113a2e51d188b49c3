package com.connectdatabase;

import java.sql.*;
import java.util.Scanner;

public class StudentCRUDMenu {

    static String url = "jdbc:postgresql://localhost:5432/college";
    static String username = "postgres";
    static String password = "root";

    public static void main(String[] args) {

        Scanner sc = new Scanner(System.in);

        while (true) {
            System.out.println("\n===== STUDENT CRUD MENU =====");
            System.out.println("1. Insert Student");
            System.out.println("2. View Students");
            System.out.println("3. Update Student");
            System.out.println("4. Delete Student");
            System.out.println("5. Exit");
            System.out.print("Enter choice: ");

            int choice = sc.nextInt();

            switch (choice) {
                case 1 -> insertStudent(sc);
                case 2 -> viewStudents();
                case 3 -> updateStudent(sc);
                case 4 -> deleteStudent(sc);
                case 5 -> {
                    System.out.println("Thank you! Bye üëã");
                    sc.close();
                    return;
                }
                default -> System.out.println("Invalid choice ‚ùå");
            }
        }
    }

    // üîπ CREATE (INSERT)
    static void insertStudent(Scanner sc) {
        String sql = "INSERT INTO student VALUES (?, ?, ?)";

        try (Connection con = DriverManager.getConnection(url, username, password);
             PreparedStatement ps = con.prepareStatement(sql)) {

            System.out.print("Enter ID: ");
            int id = sc.nextInt();
            sc.nextLine();

            System.out.print("Enter Name: ");
            String name = sc.nextLine();

            System.out.print("Enter Branch: ");
            String branch = sc.nextLine();

            ps.setInt(1, id);
            ps.setString(2, name);
            ps.setString(3, branch);

            ps.executeUpdate();
            System.out.println("Student inserted successfully ‚úÖ");

        } catch (SQLException e) {
            System.out.println("Insert failed ‚ùå");
            e.printStackTrace();
        }
    }

    // üîπ READ (SELECT)
    static void viewStudents() {
        String sql = "SELECT * FROM student";

        try (Connection con = DriverManager.getConnection(url, username, password);
             Statement st = con.createStatement();
             ResultSet rs = st.executeQuery(sql)) {

            System.out.println("\nID\tNAME\tBRANCH");
            System.out.println("-------------------------");

            while (rs.next()) {
                System.out.println(
                        rs.getInt("id") + "\t" +
                        rs.getString("name") + "\t" +
                        rs.getString("branch")
                );
            }

        } catch (SQLException e) {
            System.out.println("Fetch failed ‚ùå");
            e.printStackTrace();
        }
    }

    // üîπ UPDATE
    static void updateStudent(Scanner sc) {
        String sql = "UPDATE student SET name = ?, branch = ? WHERE id = ?";

        try (Connection con = DriverManager.getConnection(url, username, password);
             PreparedStatement ps = con.prepareStatement(sql)) {

            System.out.print("Enter ID to update: ");
            int id = sc.nextInt();
            sc.nextLine();

            System.out.print("Enter new Name: ");
            String name = sc.nextLine();

            System.out.print("Enter new Branch: ");
            String branch = sc.nextLine();

            ps.setString(1, name);
            ps.setString(2, branch);
            ps.setInt(3, id);

            int rows = ps.executeUpdate();

            if (rows > 0) {
                System.out.println("Student updated successfully ‚úÖ");
            } else {
                System.out.println("Student ID not found ‚ùå");
            }

        } catch (SQLException e) {
            System.out.println("Update failed ‚ùå");
            e.printStackTrace();
        }
    }

    // üîπ DELETE
    static void deleteStudent(Scanner sc) {
        String sql = "DELETE FROM student WHERE id = ?";

        try (Connection con = DriverManager.getConnection(url, username, password);
             PreparedStatement ps = con.prepareStatement(sql)) {

            System.out.print("Enter ID to delete: ");
            int id = sc.nextInt();

            ps.setInt(1, id);
            int rows = ps.executeUpdate();

            if (rows > 0) {
                System.out.println("Student deleted successfully ‚úÖ");
            } else {
                System.out.println("Student ID not found ‚ùå");
            }

        } catch (SQLException e) {
            System.out.println("Delete failed ‚ùå");
            e.printStackTrace();
        }
    }
}
